syntax = "proto3";

package node;

option go_package = "./proto";

service NodeService {
  rpc GetUsers(GetUsersRequest) returns (GetUsersResponse) {}
  rpc GetApiResponse(GetApiResponseRequest) returns (GetApiResponseResponse) {}
  rpc GetLogData(GetLogDataRequest) returns (GetLogDataResponse) {}

  rpc AddUser(AddUserRequest) returns (AddUserResponse) {}
  rpc DeleteUser(DeleteUserRequest) returns (DeleteUserResponse) {}
  rpc SetEnabled(SetEnabledRequest) returns (SetEnabledResponse) {}
}

message GetUsersRequest {}

message UUIDInbound {
  string uuid = 1;
  string inbound_tag = 2;
}

message User {
  string username = 1;
  repeated UUIDInbound uuid_inbounds = 2;
  bool enabled = 3;
}

message GetUsersResponse {
  repeated User users = 1;
}

message GetApiResponseRequest {}

message GetApiResponseResponse {
  repeated Stat stats = 1;
}

message Stat {
  string name = 1;
  string value = 2;
}

message GetLogDataRequest {}

message GetLogDataResponse {
  map<string, UserLogData> user_log_data = 1;
}

message UserLogData {
  repeated string valid_ips = 1;
  map<string, int32> dns_stats = 2;
}

message AddUserRequest {
  string user = 1;
  string inbound_tag = 2;
}
message AddUserResponse {
  string credential = 1;
  string error = 2;
}

message DeleteUserRequest {
  string user = 1;
  string inbound_tag = 2;
}
message DeleteUserResponse {
  string error = 1;
}

message SetEnabledRequest {
  string user = 1;
  bool enabled = 2;
}

message SetEnabledResponse {
  string error = 1;
}